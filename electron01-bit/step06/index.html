<!-- AJAX 사용법 -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>HTML</title>
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
  <style>
  .container {
    width: 600px;
    margin: 0px auto;
  }
  </style>
</head>
<body>
<div class="container">
<h1>학생 목록</h1>
<table id="student-tbl" class="table table-hover">
<thead>
  <tr>
    <th>번호</th>
    <th>이름</th>
    <th>전화</th>
    <th>이메일</th>
    <th>재직여부</th>
  </tr>
</thead>
<tbody>
</tbody>
</table>

<button type="button" class="btn btn-primary" id="add-btn">추가</button>
</div>

<script>window.$ = window.jQuery = require('jquery')</script>
<script>
const mysql = require('mysql')
const connection = mysql.createConnection({
  database: 'webappdb',
  user: 'webapp',
  password: '1111'
})
connection.connect()
</script>
<script>
"use strict"
/* AJAX 응용 II
=> 학생 목록 출력
*/
var tbody = $('#student-tbl > tbody'),
    addBtn = $('#add-btn');

/*
select m.mno, m.name, m.tel, m.email, s.work
from stud s inner join memb m on s.sno=m.mno
order by m.mno asc
limit 0, 5
*/

connection.query(
  'select m.mno, m.name, m.tel, m.email, s.work \
  from stud s inner join memb m on s.sno=m.mno  \
  order by m.mno asc \
  limit 0, 3',
  function(error, results) {
    if (error) {
      alert('데이터 조회 중 발생!')
      throw error;
    }

    for (var s of results) {
      $("<tr>").html("<td>" + s.mno +
      "</td><td><a href='#' data-no='" + s.mno + "' class='view-link'>" + s.name +
      "</a></td><td>" + s.tel +
      "</td><td>" + s.email +
      "</td><td>" + (s.work == "Y" ? "재직중" : "실업") + "</td>")
      .appendTo(tbody)
    }
    $('table .view-link').click(onClickViewLink)
})

function onClickViewLink(event) {
  location.href = 'view.html?no=' + $(this).attr('data-no')
  event.preventDefault()
}

addBtn.click(function() {
  location.href = 'view.html'
})

</script>
</body>
</html>


<!-- -->
